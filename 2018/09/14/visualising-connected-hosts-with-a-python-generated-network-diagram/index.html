<!doctype html>
<head>
	<meta name="description" content="" />
	<meta name="robots" content="index, follow" />
	<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://mattcasmith.net/2018/09/14/visualising-connected-hosts-with-a-python-generated-network-diagram/" />
	<meta property="og:locale" content="en_GB" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Visualising connected hosts with a Python-generated network diagram | MattCASmith" />
	<meta property="og:description" content="" />
	<meta property="og:url" content="https://mattcasmith.net/2018/09/14/visualising-connected-hosts-with-a-python-generated-network-diagram/" />
	<meta property="og:site_name" content="MattCASmith" />
	<meta property="article:published_time" content="2020-05-02T11:05:40+00:00" />
	<meta property="og:image" content="https://mattcasmith.net/wp-content/uploads/2018/09/network-516x270.jpg" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:creator" content="@mattcasmith" />
	<meta name="twitter:site" content="@mattcasmith" />
</head>
	<head>
		<title>Visualising connected hosts with a Python-generated network diagram | MattCASmith</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" href="/assets/images/favicon.png">
		<link rel="stylesheet" href="/assets/css/styles.css">
		<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
		
	</head>
	
	<body>
		<div id="site-container" class="post">
		<div id="header">
			<div id="header_left">
				<a href="/"><img class="site_logo light" src="/assets/images/mcas_site_logo.png"></a>
				<a href="/"><img class="site_logo dark" src="/assets/images/mcas_site_logo_dark.png"></a>
				<a href="/"><h2>MattCASmith</h2></a>
			</div>
			<div id="header_right">
				<a target="_blank" href="https://twitter.com/mattcasmith"><img class="link_icon_twitter" src="/assets/images/twitter_icon.png"></a>
				<a target="_blank" href="mailto:mattcasmith@protonmail.com"><img class="link_icon_email light" src="/assets/images/email_icon.png"></a>
				<a target="_blank" href="mailto:mattcasmith@protonmail.com"><img class="link_icon_email dark" src="/assets/images/email_icon_dark.png"></a>
			</div>
		</div>
		
		<div class="title">
			<h1 class="entry-title">Visualising connected hosts with a Python-generated network diagram</h1>
		</div>
		
		<div class="meta">
			<span class="year_label">2018-09-14</span> |&nbsp;&nbsp;&nbsp; 
				
				
					<a href="/category/cyber-security.html">Cyber Security</a>,&nbsp;&nbsp;
				
					<a href="/category/programming.html">Programming</a>
				
			
		</div>
		
		<img src="/wp-content/uploads/2018/09/network-516x270.jpg" alt="Visualising connected hosts with a Python-generated network diagram" />
		
		<p>The bulk of cyber security incidents are fairly simple, but sometimes you end up working with a whole network of hosts that are connected to each other in different ways. With this scenario in mind, I recently set out to explore the possibility of creating a Python script to automatically generate a simple network diagram to visualise things more clearly.<!--more--></p>

<h3 id="setting-things-up">Setting things up</h3>

<p>Before we get properly started, another Python project means another block of setup code where we prepare the libraries and files that we’ll be using through the rest of the script.</p>

<?prettify linenums=true?>

<pre class="prettyprint">import networkx as nx
import matplotlib.pyplot as plt
source = open("hosts.txt", "r")
G = nx.Graph()</pre>

<p>NetworkX is the library we’ll be using to plot the diagram, while Matplotlib will be used to export it as a pretty PNG. Our input will be a file called hosts.txt with a line per host in the format: “source_hostname:connected_host_1,connected_host_2,connected_host_3”. For the sake of simplicity, the NetworkX graph function will be abbreviated to “G”.</p>

<h3 id="producing-lists-of-hosts-and-connections">Producing lists of hosts and connections</h3>

<p>The first thing we need to do is make sense of hosts.txt and build definitive lists of all the hosts and connections that will be included in the final network diagram.</p>

<?prettify linenums=true?>

<pre class="prettyprint">all_hosts = []
for line in source:
    line = line[:-1]
    host_record = line.rsplit(":", 1)
    all_hosts.append(host_record[0])
    sub_hosts = host_record[1]
    sub_hosts = sub_hosts.split(",")
    all_hosts.extend(sub_hosts)
all_hosts = set(all_hosts)
all_hosts = list(all_hosts)
source.seek(0)</pre>

<p>Let’s start with the hosts. These are before the colon on each line, so all we need to do is split each line at the colon and add the preceding text to a Python list. Then we use the source.seek function to return to the start of the input file ready for our next actions.</p>

<?prettify linenums=true?>

<pre class="prettyprint">all_links = []
for line in source:
    line = line[:-1]
    host_record = line.rsplit(":", 1)
    current_host = host_record[0]
    current_connections = host_record[1].rsplit(",")
    for connection in current_connections:
        to_append = current_host + "," + connection
        all_links.append(to_append)
source.seek(0)</pre>

<p>Now we repeat the process for the connections, which is a little more complicated because there are more than one per source host. Again we take the source hostname from before the colon, but this time we split what comes afterwards at each comma and create a new list entry for each connection in the format “source_hostname,connected_hostname”.</p>

<h3 id="plotting-the-hosts-and-connections-on-the-diagram">Plotting the hosts and connections on the diagram</h3>

<p>Now that we’ve successfully arranged our two datasets, it’s time to plot them as nodes and lines on a diagram using NetworkX, which is a fairly simple process.</p>

<?prettify linenums=true?>

<pre class="prettyprint">for host in all_hosts:
    if host == "":
        pass
    else:
        G.add_node(host)</pre>

<p>First, we iterate through the list of hosts, adding each as a node on the diagram. The if statement here checks to see if an entry in the list is blank and ignores it, which helps to prevent errors if your initial hosts.txt file contained any blank lines.</p>

<?prettify linenums=true?>

<pre class="prettyprint">for link in all_links:
    all_links_dict = {}
    first_part = link.split(",")[0]
    last_part = link.split(",")[1]
    all_links_dict[first_part] = 0
    all_links_dict[last_part] = 1
    G.add_edges_from([all_links_dict])</pre>

<p>Once again, the process is slightly more complex for the connections, which need to be split into two segments (the source hostname and the destination hostname). Once these parts are added to a dictionary, NetworkX will accept them as the two ends of an edge (or line).</p>

<h3 id="exporting-a-pretty-diagram">Exporting a pretty diagram</h3>

<p>The final step is to generate the network diagram with NetworkX and then export it as a PNG image with Matplotlib, which is a fairly self-explanatory few lines of code.</p>

<?prettify linenums=true?>

<pre class="prettyprint">nx.draw(G, with_labels=True, font_size='6', node_color="blue", node_size=160, font_color="white")
plt.savefig("graph.png", dpi=500)
source.close()</pre>

<p>Note that both functions have a series of attributes that can be tweaked to your heart’s content (there are more than I’ve used here, too). When we’re finished, we also close the source file to keep things nice and tidy and allow us to edit it with other programs.</p>

<h3 id="the-output">The output</h3>

<p>So what do we get for our trouble? The result is a neat little PNG network diagram that makes visualising the network you’re investigating much easier.</p>

<p><img src="https://i1.wp.com/mattcasmith.net/wp-content/uploads/2018/09/diagram.png" alt="" style="width:100% !important;" data-recalc-dims="1" /></p>

<p>If yours isn’t as tidy as mine, try playing with the various formatting attributes in the last step, or simply try executing your Python script again – NetworkX sometimes cycles through a few different layouts if it is run again, and some of them are a lot prettier than others.</p>

<div style="background: #ffffd8 !important; float: left; margin-bottom: 20px;">
  <p style="padding: 20px; margin: 0;">
    A note: I&#8217;m only just delving into the world of Python, and these posts are as much to get things straight in my own head as they are to show them to others. If anything looks wrong, or there&#8217;s a more efficient way of doing something, please let me know!
  </p>
</div>

<hr />

<p><em>Photo from <a target="_blank" href="https://www.pexels.com/photo/abstract-art-blur-bright-373543/">Pexels</a></em></p>

		
		<div id="prev_next">
			<div class="prev">
				    
						<a href="/2018/09/07/seven-tips-new-cyber-security-consultants/">&laquo;&nbsp;Seven things I&#8217;ve learnt in my first year as a cyber security consultant</a>
					
			</div>
			<div class="next">
				    
						<a href="/2018/09/22/approaching-incident-response-on-the-front-foot-with-the-harm-method/">Approaching incident response on the front foot with the HARM method&nbsp;&raquo;</a>
					
			</div>
		</div>
		
		<div id="footer">
			&copy; 2017-20 MattCASmith
			<span class="home-link"><a href="/">Go home</a></span>
		</div>
		
		</div>
	
	</body>
</html>