<!doctype html>
<head>
	<meta name="description" content="" />
	<meta name="robots" content="index, follow" />
	<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://mattcasmith.net/2022/01/08/sans-holiday-hack-2021-slot-machine" />
	<meta property="og:locale" content="en_GB" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="SANS Holiday Hack Challenge 2021&#58; Slot machine walkthrough | MattCASmith" />
	<meta property="og:description" content="" />
	<meta property="og:url" content="https://mattcasmith.net/2022/01/08/sans-holiday-hack-2021-slot-machine" />
	<meta property="og:site_name" content="MattCASmith" />
	<meta property="article:published_time" content="2020-05-02T11:05:40+00:00" />
	<meta property="og:image" content="https://mattcasmith.net/wp-content/uploads/2022/01/sans-holiday-challenge-slots_1.png" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:creator" content="@mattcasmith" />
	<meta name="twitter:site" content="@mattcasmith" />
</head>
	<head>
		<style>
			html {
				display: none;
			}
		</style>
		<title>SANS Holiday Hack Challenge 2021&#58; Slot machine walkthrough | MattCASmith</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" href="/assets/images/favicon.png">
		<link rel="stylesheet" href="/assets/css/styles.css">
		<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
		
	</head>
	
	<body>
		<div id="site-container" class="post">
		<div id="header">
			<div id="header_left">
				<a href="/"><img class="site_logo light" src="/assets/images/mcas_site_logo.png"></a>
				<a href="/"><img class="site_logo dark" src="/assets/images/mcas_site_logo_dark.png"></a>
				<a href="/"><h2>MattCASmith</h2></a>
			</div>
			<div id="header_right">
				<a target="_blank" href="https://twitter.com/mattcasmith"><img class="link_icon_twitter" src="/assets/images/twitter_icon.png"></a>
				<a target="_blank" href="mailto:mattcasmith@protonmail.com"><img class="link_icon_email light" src="/assets/images/email_icon.png"></a>
				<a target="_blank" href="mailto:mattcasmith@protonmail.com"><img class="link_icon_email dark" src="/assets/images/email_icon_dark.png"></a>
			</div>
		</div>
		
		<div class="title">
			<h1 class="entry-title">SANS Holiday Hack Challenge 2021&#58; Slot machine walkthrough</h1>
		</div>
		
		<div class="meta">
			<span class="year_label">2022-01-08</span>&nbsp; 
				
				
					<a href="/category/cyber-security.html">Cyber security</a>
				
			
		</div>
		
		<p>Here’s one more writeup from the <a href="https://www.sans.org/mlp/holiday-hack-challenge/" target="_blank">SANS Holiday Hack Challenge</a>! The slot machine hack was one of the showpiece challenges this year, so I thought I’d put together a quick blog post to guide you through the process of identifying and exploiting a vulnerability in the game.</p>

<h3 id="the-challenge">The challenge</h3>

<p>Our task is clear enough. We’re given a link to an online slot machine and the following request:</p>

<blockquote>
  <p>Test the security of Jack Frost’s slot machines. What does the Jack Frost Tower casino security team threaten to do when your coin total exceeds 1,000? Submit the string in the server <code>data.response</code> element.</p>
</blockquote>

<p>Let’s follow the link and take a look at the slot machine. It’s fairly typical for such games (at least as per my understanding following <a href="/2019/08/26/im-back-def-con-inspired-hacking/">a short trip to Las Vegas for Black Hat and Def Con</a>). You can choose various options before placing a bet by hitting the Spin button. Your credit is updated based on the outcome.</p>

<p><img src="/wp-content/uploads/2022/01/sans-holiday-challenge-slots_1.png" /></p>

<p>Since our objective is to hit more than 1,000 credit, we <em>could</em> just play the slots for a long time to try to get lucky. But that would take forever. Instead, let’s take under the hood to see what we can hack…</p>

<h3 id="observing-requests">Observing requests</h3>

<p>Like any web application, the slot machine must be communicating with a server behind the scenes to make playing the game possible. By using the Burp Suite proxy’s intercept function, we can hold requests and responses between the web browser and the server to give us time to review their contents and see what’s going on when we place a bet. Here’s what is sent when we hit the Spin button…</p>

<p><img src="/wp-content/uploads/2022/01/sans-holiday-challenge-slots_2.png" /></p>

<p>This looks like a pretty standard web request. We can see that this is a <code>POST</code> request, which means that the client is transmitting information to the server (<code>slots.jackfrosttower.com</code>). We can see that the request provides some cookie information, details about the page we’re on and our user agent, and so on. This is all pretty normal for this kind of request. But what about that last line?</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">betamount</span><span class="o">=</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">numline</span><span class="o">=</span><span class="mi">20</span><span class="o">&amp;</span><span class="n">cpl</span><span class="o">=</span><span class="mf">0.1</span></code></pre></figure>

<p>Comparing these variable names to the GUI, we can ascertain that this is our browser telling the server how much we’re betting, the number of lines we’re betting on, and the cost per line. Interesting. By tweaking these values, we might be able to:</p>

<ul>
  <li>Change the bet amount to a bigger stake than we can actually afford</li>
  <li>Bet on more lines than actually exist on the slot machine</li>
  <li>Adjust the cost per line to alter the slot machine’s financial calculations</li>
</ul>

<p>From here, it’s a matter of trial and error. Attempting the first two potential exploits returns a <code>Server Error</code> response. That leaves only one option - but how can we use the <code>cpl</code> variable to our advantage?</p>

<h3 id="crafting-a-malicious-request">Crafting a malicious request</h3>

<p>So here’s the plan: We’re going to set <code>cpl</code> to a negative value to confuse the game if this input isn’t validated. For example, if we set it to <code>-100</code> and there are 20 lines to play, that spin would cost us -2,000 credits to play and therefore actually <em>increase</em> our credit by 2,000 (and any winnings from the spin).</p>

<p>To do this, we hit the Spin button on the slot machine’s GUI. Burp Suite intercepts the request. We must very quickly change the <code>cpl</code> value to <code>-100</code> and hit the Forward button before the spin times out.</p>

<p><img src="/wp-content/uploads/2022/01/sans-holiday-challenge-slots_3.png" /></p>

<p>It looks like the server doesn’t check that <code>cpl</code> is set to a valid value before executing the spin. All goes to plan and when the play is complete our credit is now in the thousands! Mission complete - almost.</p>

<p>Our task was actually to find a value in the JSON response once our credit exceeds 1,000. To do this, we can take a look for the relevant request and response on Burp Suite’s HTTP history page. Sure enough, in the <code>data.response</code> field, we can see the following message from casino security:</p>

<p><img src="/wp-content/uploads/2022/01/sans-holiday-challenge-slots_4.png" /></p>

<p>And that’s our flag: <code>I'm going to have some bouncer trolls bounce you right out of this casino!</code> Hopefully we have enough time to submit it and take the credit for our hacking first.</p>

<p>If you found this walkthrough interesting, please consider <a href="https://twitter.com/mattcasmith" target="_blank">following me on Twitter</a>, and don’t forget to sign up for the next SANS Holiday Hack Challenge circa December 2022!</p>

		
		<div id="cta">
	Looking for the comments? My website doesn't have a comments section because it would take a fair amount of effort to maintain and wouldn't usually present much value to readers. However, if you have thoughts to share I'd love to hear from you - feel free to send me <a href="https://twitter.com/mattcasmith" target="_blank">a tweet</a> or <a href="mailto:mattcasmith@protonmail.com">an email</a>.
</div>
		
		<div id="prev_next">
			<div class="prev">
				    
						<a href="/2022/01/08/sans-holiday-hack-2021-yara-rules">&laquo;&nbsp;SANS Holiday Hack Challenge 2021&#58; Yara rule analysis walkthrough</a>
					
			</div>
			<div class="next">
				    
						<a href="/2022/02/22/bash-history-basics-behaviours-forensics">Linux .bash&#95;history&#58; Basics, behaviours, and forensics&nbsp;&raquo;</a>
					
			</div>
		</div>
		
		
				<div id="footer">
			&copy; 2016-22 MattCASmith
			<span class="home-link">Personal blog - does not reflect views of employers past or present</span>
		</div>
		
		<script data-goatcounter="https://mattcasmith.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
		
		</div>
	
	</body>
</html>