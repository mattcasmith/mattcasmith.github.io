<!doctype html>
<head>
	<meta name="description" content="" />
	<meta name="robots" content="index, follow" />
	<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://mattcasmith.net/2019/03/09/raspberry-pi-home-hub-email-briefing/" />
	<meta property="og:locale" content="en_GB" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Raspberry Pi Home Hub: Building and sending a daily email briefing | MattCASmith" />
	<meta property="og:description" content="" />
	<meta property="og:url" content="https://mattcasmith.net/2019/03/09/raspberry-pi-home-hub-email-briefing/" />
	<meta property="og:site_name" content="MattCASmith" />
	<meta property="article:published_time" content="2020-05-02T11:05:40+00:00" />
	<meta property="og:image" content="https://mattcasmith.net/wp-content/uploads/2019/03/emailbriefingfeatured1.jpg" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:creator" content="@mattcasmith" />
	<meta name="twitter:site" content="@mattcasmith" />
	<meta name="twitter:image" content="https://mattcasmith.net/wp-content/uploads/2019/03/emailbriefingfeatured1.jpg" />
</head>
	<head>
		<style>
			html {
				display: none;
			}
		</style>
		<title>Raspberry Pi Home Hub: Building and sending a daily email briefing | MattCASmith</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" href="/assets/images/favicon.png">
		<link rel="stylesheet" href="/assets/css/styles.css">
		<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
	</head>
	
	<body>
		<div id="site-container" class="post">
		<div id="header">
			<div id="header_left">
				<a href="/"><img class="site_logo light" src="/assets/images/mcas_site_logo.png" alt="MattCASmith"></a>
				<a href="/"><img class="site_logo dark" src="/assets/images/mcas_site_logo_dark.png" alt="MattCASmith"></a>
				<a href="/"><h2>MattCASmith</h2></a>
			</div>
			<div id="header_right">
				<a target="_blank" href="https://x.com/mattcasmith"><img class="link_icon_twitter light" src="/assets/images/x_icon.png" alt="MattCASmith on X"></a>
				<a target="_blank" href="https://x.com/mattcasmith"><img class="link_icon_twitter dark" src="/assets/images/x_icon_dark.png" alt="MattCASmith on X"></a>
				<a target="_blank" href="mailto:mattcasmith@protonmail.com"><img class="link_icon_email light" src="/assets/images/email_icon.png" alt="Email MattCASmith"></a>
				<a target="_blank" href="mailto:mattcasmith@protonmail.com"><img class="link_icon_email dark" src="/assets/images/email_icon_dark.png" alt="Email MattCASmith"></a>
			</div>
		</div>
		
		<article class="post">

			<nav class="top_nav">
				<a href="/">HOME</a>
				<a href="/category/technology" >TECHNOLOGY</a>
				<a href="/category/business" >BUSINESS</a>
				<a href="/category/productivity" >PRODUCTIVITY</a>
				<a href="/category/design" >DESIGN</a>
				<a href="/category/cyber-security" >CYBER SECURITY</a>
				<a href="/category/programming" >CODING</a>
				<a href="/category/off-topic" >MISC</a>
			</nav>	

			<div class="title">
				<h1 class="entry-title">Raspberry Pi Home Hub: Building and sending a daily email briefing</h1>
			</div>
			
			<div class="meta">
				<span class="year_label">2019-03-09</span>&nbsp; 
					
					
						<a href="/category/design/">Design</a>,&nbsp;&nbsp;
					
						<a href="/category/programming/">Programming</a>
					
				
			</div>

			<div class="post_content_container_ext">

				<div class="post_content_container_int">
					<p><img src="/wp-content/uploads/2019/03/emailbriefingfeatured1.jpg" /></p>

<p>The next feature for my Raspberry Pi Home Hub is a Python script that will automatically send an email briefing every morning. In this post I‚Äôll be creating the template, populating it with up-to-date information, and sending it with Yagmail.<!--more--></p>

<h3 id="how-the-email-briefing-will-work">How the email briefing will work</h3>

<p><a href="https://mattcasmith.net/2019/01/11/raspberry-pi-home-hub-intro-objectives/" target="_blank" rel="noopener noreferrer">The specifications for my Raspberry Pi Home Hub</a> state: ‚ÄúThe Home Hub will automatically send a briefing email at around 6:30am every day containing information that would be useful to review each morning.‚Äù The way I‚Äôm going to implement this can be broken down into four primary steps:</p>

<ol>
  <li>Create an HTML email briefing template</li>
  <li>Populate the email template with up-to-date information</li>
  <li>Send the email using the Yagmail Python library</li>
  <li>Create a Linux cron job to automatically run the script each day</li>
</ol>

<p>This post will cover the middle two steps, under the assumption that an HTML template has already been created containing variables looking something like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">[</span><span class="n">html</span><span class="p">][</span><span class="n">head</span><span class="p">][</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s">"Content-Type"</span> <span class="n">content</span><span class="o">=</span><span class="s">"text/html charset=UTF-8"</span> <span class="o">/</span><span class="p">][</span><span class="o">/</span><span class="n">head</span><span class="p">]</span>
<span class="p">[</span><span class="n">body</span> <span class="n">style</span><span class="o">=</span><span class="s">"max-width: 400px; margin: 0; padding: 0;"</span><span class="p">]</span>
<span class="p">[</span><span class="n">p</span> <span class="n">style</span><span class="o">=</span><span class="s">"color: #fff; background: #333; margin: 0 0 20px; padding: 20px 5%; font-size: 32pt; font-family: Helvetica; font-weight: bold; width: 90%;"</span><span class="p">]</span><span class="n">Daily</span> <span class="n">Briefing</span><span class="p">[</span><span class="o">/</span><span class="n">p</span><span class="p">]</span>
<span class="p">[</span><span class="n">p</span> <span class="n">style</span><span class="o">=</span><span class="s">"color: #333; margin: 15px 5%; font-family: Georgia; font-size: 14pt; line-height: 18pt;"</span><span class="p">]{</span><span class="err">$</span><span class="n">v0</span><span class="p">}</span> <span class="n">Today</span> <span class="ow">is</span> <span class="p">[</span><span class="n">b</span><span class="p">]{</span><span class="err">$</span><span class="n">v1</span><span class="p">}[</span><span class="o">/</span><span class="n">b</span><span class="p">].[</span><span class="o">/</span><span class="n">p</span><span class="p">]</span>
<span class="p">...</span></code></pre></figure>

<p>Note that this HTML is messier than <a href="https://mattcasmith.net/2019/02/08/raspberry-pi-home-hub-news-weather/" target="_blank" rel="noopener noreferrer">the template for the news and weather screen</a>. As this is an email template, all the formatting must be in-line, rather than in a separate CSS stylesheet.</p>

<p>As the news and weather screen is the only one we‚Äôve created to date, we‚Äôll focus on gathering up-to-date news headlines, travel information, and weather updates and packaging them in a nice daily email briefing for the user along with a random greeting and tips for the day.</p>

<h3 id="setting-things-up">Setting things up</h3>

<p>As with any Home Hub module, the first step is to import some libraries and build some variables.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">yagmail</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">feedparser</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">string</span></code></pre></figure>

<p>We saw most of these libraries the last time around ‚Äì the important addition is Yagmail, which will enable the Python script to connect to a Gmail account I‚Äôve created for the Home Hub and send the briefing to my address. All of these variables are defined in the <code class="language-plaintext highlighter-rouge">config.ini</code> file we created before.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">weather_feed_url</span> <span class="o">=</span> <span class="s">"http://datapoint.metoffice.gov.uk/public/data/val/wxfcs/all/xml/"</span> <span class="o">+</span> <span class="n">weather_location_id</span> <span class="o">+</span> <span class="s">"?res=daily&amp;key="</span> <span class="o">+</span> <span class="n">weather_api_key</span>
<span class="n">tube_feed_url</span> <span class="o">=</span> <span class="s">"https://api.tfl.gov.uk/Line/"</span> <span class="o">+</span> <span class="n">tube_line</span> <span class="o">+</span> <span class="s">"/Status"</span></code></pre></figure>

<p>Next we define <code class="language-plaintext highlighter-rouge">weather_feed_url</code> and <code class="language-plaintext highlighter-rouge">tube_feed_url</code> as we did in the last module, using the variables in <code class="language-plaintext highlighter-rouge">config.ini</code> to build out the addresses required to fetch the data.</p>

<h3 id="adding-a-greeting">Adding a greeting</h3>

<p>To make waking up in the morning a bit more pleasant, let‚Äôs add a random greeting to kick the email off. This will be followed by the date in the format: ‚ÄúToday is Friday 8th March 2019.‚Äù</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">greetings</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Good morning!"</span><span class="p">,</span> <span class="s">"Wakey wakey!"</span><span class="p">,</span> <span class="s">"Time to get up!"</span><span class="p">,</span> <span class="s">"Ohayo!"</span><span class="p">,</span> <span class="s">"Rise and shine!"</span><span class="p">,</span> <span class="s">"Top of the morning!"</span><span class="p">,</span> <span class="s">"Wake up and smell the coffee!"</span><span class="p">]</span>
<span class="n">number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">greetings</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">random_number</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">number</span><span class="p">)</span>
<span class="n">v0</span> <span class="o">=</span> <span class="n">greetings</span><span class="p">[</span><span class="n">random_number</span><span class="p">]</span></code></pre></figure>

<p>I‚Äôve added all the possible greetings to a Python list called <code class="language-plaintext highlighter-rouge">greetings</code>. The script then counts the number of entries in the list and generates a random number up to that count. The entry at that number is selected and assigned to the <code class="language-plaintext highlighter-rouge">v0</code> variable ready to populate the email template.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">date</span><span class="p">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">day</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%d'</span><span class="p">))</span>
<span class="k">if</span> <span class="n">day</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">"st "</span>
<span class="k">elif</span> <span class="n">day</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">suffix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="s">"nd "</span>
<span class="k">elif</span> <span class="n">day</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">"rd "</span>
<span class="k">elif</span> <span class="n">day</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">"th "</span>
<span class="n">v1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%A %d'</span><span class="p">))</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%B %Y'</span><span class="p">))</span></code></pre></figure>

<p>Generating the date is simple enough using the <code class="language-plaintext highlighter-rouge">today.strftime</code> function, but we still have to do a little work to generate the correct suffix (‚Äúst‚Äù, ‚Äúnd‚Äù, ‚Äúrd‚Äù, or ‚Äúth‚Äù). This is achieved by running an <code class="language-plaintext highlighter-rouge">if</code> loop on the day number, which is generated with <code class="language-plaintext highlighter-rouge">today.strftime('%d')</code> and assigned to <code class="language-plaintext highlighter-rouge">day</code>.</p>

<h3 id="adding-weather-information">Adding weather information</h3>

<p>The process for fetching the news, weather, and Tube status is the same as in <a href="https://mattcasmith.net/2019/02/08/raspberry-pi-home-hub-news-weather/" target="_blank" rel="noopener noreferrer">the news screen script</a>. For weather, we use <code class="language-plaintext highlighter-rouge">requests</code> to fetch the data from the Met Office.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">weather_data</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">weather_feed_url</span><span class="p">)</span>
<span class="n">weather_data</span> <span class="o">=</span> <span class="n">weather_data</span><span class="p">.</span><span class="n">content</span>
<span class="n">weather_today_temp</span> <span class="o">=</span> <span class="n">weather_data</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'FDm=</span><span class="se">\"</span><span class="s">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">weather_today_temp</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\"</span><span class="s">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">weather_today_type</span> <span class="o">=</span> <span class="n">weather_data</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'W=</span><span class="se">\"</span><span class="s">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">v3</span> <span class="o">=</span> <span class="n">weather_today_type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">weather_today_type</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\"</span><span class="s">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span></code></pre></figure>

<p>The data returned is then split in various ways to get today‚Äôs temperature and weather type and assign them to the <code class="language-plaintext highlighter-rouge">v2</code> and <code class="language-plaintext highlighter-rouge">v3</code> variables. We‚Äôll need to do a bit more work with these later to convert the weather type number into descriptive text to use in the email template.</p>

<h3 id="adding-transport-updates">Adding transport updates</h3>

<p>The current London Underground state is also retrieved using <code class="language-plaintext highlighter-rouge">requests</code> and <code class="language-plaintext highlighter-rouge">split</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">transport_data</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">tube_feed_url</span><span class="p">)</span>
<span class="n">northern_line_status</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">transport_data</span><span class="p">.</span><span class="n">content</span><span class="p">))</span>
<span class="n">northern_line_status</span> <span class="o">=</span> <span class="n">northern_line_status</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'u</span><span class="se">\'</span><span class="s">statusSeverityDescription'</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">northern_line_status</span> <span class="o">=</span> <span class="n">northern_line_status</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
<span class="n">v4</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">lower</span><span class="p">(</span><span class="n">northern_line_status</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\'</span><span class="s">'</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span></code></pre></figure>

<p>Unlike the news and weather screen script, the email briefing script returns the description of the current Tube line status, rather than a number. This string is converted to lower case with <code class="language-plaintext highlighter-rouge">string.lower</code> so it‚Äôs suitable for use in its location in the email template.</p>

<h3 id="adding-news-headlines">Adding news headlines</h3>

<p>The latest news headlines are returned using <code class="language-plaintext highlighter-rouge">feedparser</code> and the BBC News RSS feed URL.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">news_data</span> <span class="o">=</span> <span class="n">feedparser</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">news_feed_url</span><span class="p">)</span>
<span class="n">v5</span> <span class="o">=</span> <span class="n">news_data</span><span class="p">[</span><span class="s">'entries'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'media_thumbnail'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'url'</span><span class="p">]</span>
<span class="n">v6</span> <span class="o">=</span> <span class="n">news_data</span><span class="p">[</span><span class="s">'entries'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'link'</span><span class="p">]</span>
<span class="n">v7</span> <span class="o">=</span> <span class="n">news_data</span><span class="p">[</span><span class="s">'entries'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'title'</span><span class="p">]</span>
<span class="n">v8</span> <span class="o">=</span> <span class="n">news_data</span><span class="p">[</span><span class="s">'entries'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'summary'</span><span class="p">]</span>
<span class="n">v9</span> <span class="o">=</span> <span class="n">news_data</span><span class="p">[</span><span class="s">'entries'</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s">'title'</span><span class="p">]</span>
<span class="n">v10</span> <span class="o">=</span> <span class="n">news_data</span><span class="p">[</span><span class="s">'entries'</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s">'link'</span><span class="p">]</span>
<span class="p">...</span></code></pre></figure>

<p>The top story will feature a thumbnail, headline, and short description, while the other stores will just be clickable headlines. The required information is returned by querying <code class="language-plaintext highlighter-rouge">news_data['entries']</code> and assigned to a series of variables to be used in the briefing template.</p>

<h3 id="populating-the-email-template">Populating the email template</h3>

<p>Now we have all the information, it‚Äôs time to populate the HTML email template.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">template</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"html/templates/email.htm"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span>
<span class="n">contents</span> <span class="o">=</span> <span class="p">[]</span></code></pre></figure>

<p>First we open the template file, which is stored in the <code class="language-plaintext highlighter-rouge">templates</code> folder in the app‚Äôs <code class="language-plaintext highlighter-rouge">html</code> directory. We create a blank variable called <code class="language-plaintext highlighter-rouge">contents</code> to store the completed email template for sending. Data is appended line by line, in the same way the news and weather screen was built.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">template</span><span class="p">:</span>
    <span class="k">if</span> <span class="s">"{$v0}"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">'{$v0}'</span><span class="p">,</span> <span class="n">v0</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">"{$v1}"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">'{$v1}'</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">"{$v2}"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">'{$v2}'</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">"{$v3}"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">'{$v3}'</span><span class="p">,</span> <span class="s">"clear"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">'{$v3}'</span><span class="p">,</span> <span class="s">"sunny"</span><span class="p">)</span>
    <span class="p">...</span></code></pre></figure>

<p>For most variables it‚Äôs just a case of iterating through the lines and switching out the placeholder for the contents of the correct variable. For others, like the type of weather, we need to select the correct replacement string based on the variable‚Äôs value with a nested <code class="language-plaintext highlighter-rouge">if</code> statement.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">contents</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code></pre></figure>

<p>Once each line as been checked for all variable tags, it is added to the populated HTML file.</p>

<h3 id="sending-the-email">Sending the email</h3>

<p>Once the email HTML has been fully built, it‚Äôs time to send it. To connect via SMTP, Yagmail requires the sender Gmail account‚Äôs address and password, which I have fetched from <code class="language-plaintext highlighter-rouge">config.ini</code>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">subject</span> <span class="o">=</span> <span class="s">"Daily Briefing: "</span> <span class="o">+</span> <span class="n">v1</span>
<span class="n">yag</span> <span class="o">=</span> <span class="n">yagmail</span><span class="p">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">sender_address</span><span class="p">,</span> <span class="n">sender_app_pw</span><span class="p">)</span>
<span class="n">yag</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">destination_address</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span></code></pre></figure>

<p>Next we use <code class="language-plaintext highlighter-rouge">yag.send</code> along with the destination address (also from the configuration file), the email subject line, and the <code class="language-plaintext highlighter-rouge">contents</code> variable, which at this point contains the HTML for the entire email. If everything is configured correctly, we should now receive our briefing when we run the script!</p>

<h3 id="the-output">The output</h3>

<p>If we check our inbox, we‚Äôll see a nicely formatted email briefing with a random greeting, the latest news headlines, weather (and advice on what to wear out), and travel updates.</p>

<p><a href="/wp-content/uploads/2019/03/homehubemailbriefing.jpg?ssl=1"><img src="/wp-content/uploads/2019/03/homehubemailbriefing.jpg" /></a></p>

<p>Now the Raspberry Pi Home Hub is capable of <a href="https://mattcasmith.net/2019/02/08/raspberry-pi-home-hub-news-weather/" target="_blank" rel="noopener noreferrer">displaying the latest news, weather, and travel information</a> and sending a daily email briefing. Next month I‚Äôll be building the energy screen, which will fetch information from Google Sheets and calculate my next energy bills. Look out for a blog post about that in the near future, and be sure to <a href="https://mattcasmith.net/tag/raspberry-pi-home-hub" target="_blank" rel="noopener noreferrer">visit the project page</a> if you didn‚Äôt catch the other posts.</p>

					<div id="newsletter_post">
	<h3>Field Notes // A monthly newsletter by MattCASmith</h3>
	<p>A monthly roundup of my latest writing, plus observations and recommendations I don't share anywhere else</p>
	<iframe src="https://embeds.beehiiv.com/77e2fe29-a7bd-4886-9f77-4370f9ad2ee9?slim=true" data-test-id="beehiiv-embed" height="53" frameborder="0" scrolling="no" style="margin: 0; border-radius: 0px !important; background-color: transparent;"></iframe>
</div>

<div id="cta">
	If this article resonated, feel free to share it with someone who might appreciate it too. If you have thoughts, opinions, or comments to share then I'd love to hear from you - feel free to send me <a href="https://x.com/mattcasmith" target="_blank">a message on X</a> or <a href="mailto:mattcasmith@protonmail.com">an email</a>.
</div>
				</div>

				<a href="https://mattcasmith.beehiiv.com/subscribe" target="_blank">
<div id="newsletter_sidebar">
	<table>
		<tr>
			<td>
				<h3>üìì</h3>
			</td>
			<td>	
				<h2>Field Notes newsletter</h2>
			</td>
		</tr>
	</table>
	<p>A monthly roundup of my latest writing, plus exclusive links and observations</p>
	<button>Subscribe</button>
</div>
</a>
<p class="newsletter_disclaimer">No spam. Unsubscribe anytime.</p>
				<div id="home_sidebar">
					<div id="home_about_boxes">
						<div class="home_about_box home_box">
							<h2>Categories</h2>
							<div id="side_menu">
	<ul class="side_menu">
		<a href="/category/technology"><li class="first">Technology</li></a>
		<a href="/category/business"><li>Business</li></a>
		<a href="/category/productivity"><li>Productivity</li></a>
		<a href="/category/design"><li>Design</li></a>
		<a href="/category/cyber-security"><li>Cyber Security</li></a>
		<a href="/category/programming"><li>Coding</li></a>
		<a href="/category/off-topic"><li>Miscellaneous</li></a>
	</ul>
</div>
						</div>
						<div class="home_about_box home_box">
							<h2>Index & projects</h2>
							<a href="/blog-index.htm"><div class="home-button green-button">Blog index</div></a>
<div id="side_menu">
	<ul class="side_menu">
		<a href="/2021/01/01/backutil-windows-backup-utility" class="home-index"><li class="first">Backutil</li></a>
		<a href="/2022/12/03/parsing-login-sessions-windows-security-event-log-powershell" class="home-index"><li>EVTX login parser</li></a>
		<a href="/recommendations.htm" class="home-index"><li>Recommendations</li></a>
	</ul>
</div>
						</div>
						<div class="home_about_box home_box">
							<h2>Other posts</h2>
							<div id="other_posts_list">
							<ul class="other_posts_list">
								
								
								
								
								
								
								
									
									
									
				                    	
				                        	
				                        		<a href="/2024/07/20/crowdstrike-bug-edr-setting-record-straight">
				                        			<li class="first">Endpoint detection and response (EDR) - setting the record straight</li>
					    	                	</a>
					    	                	
					    	                        
					                    	
					                    	
				                    	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/10/03/new-york-observations-recommendations">
				                        			<li>New York City&#58; Observations and recommendations</li>
					    	                	</a>
					    	                          
				                    		
					                    	
					                    
				                	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/09/21/note-taking-waste-less-time-online">
				                        			<li>Take note&#58; How to waste less time on the internet</li>
					    	                	</a>
					    	                       
				                    		
				                    		
				                    	
				                	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/09/13/you-can-just-do-things-kind-of">
				                        			<li>A reminder that you can just do things... kind of</li>
					    	                	</a>
					    	                         
				                    		
				                    		
				                    	
				                	
						    	
									
									
									
				                    	
				                        	
				                        		<a href="/2025/05/10/travel-tourism-photos-experience">
				                        			<li>When you travel, the real journey isn't photographed</li>
					    	                	</a>
					    	                        
					                    	
					                    	
				                    	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/10/19/ai-security-operations-untapped-potential">
				                        			<li>The untapped potential of AI for security operations</li>
					    	                	</a>
					    	                          
				                    		
					                    	
					                    
				                	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/10/11/field-notes-4-october-2025">
				                        			<li>Field Notes 4 // New York, note taking, and Blindr</li>
					    	                	</a>
					    	                       
				                    		
				                    		
				                    	
				                	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/10/05/anthropic-claude-ai-marketing-design">
				                        			<li>Claude's caf√© pop-up convinced me to switch LLMs</li>
					    	                	</a>
					    	                         
				                    		
				                    		
				                    	
				                	
						    	
									
									
									
									
									
				                    	
				                	
				                	
									
									
				                    	
				                	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/07/06/kojima-death-stranding-world-strand-tour">
				                        			<li>Death Stranding&#58; The journeys lost to life on demand</li>
					    	                	</a>
					    	                         
				                    		
				                    		
				                    	
				                	
						    	
									
									
									
				                    	
				                        	
				                        		<a href="/2025/05/31/abstraction-quality-detail-obsessed-leaders">
				                        			<li>Quality products begin with detail-obsessed leaders</li>
					    	                	</a>
					    	                        
					                    	
					                    	
				                    	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/10/26/etherhiding-blockchain-malware">
				                        			<li>EtherHiding&#58; When good blockchains turn bad</li>
					    	                	</a>
					    	                          
				                    		
					                    	
					                    
				                	
				                	
									
									
				                    	
				                	
				                	
									
									
				                    	
				                	
						    	
									
									
									
				                    	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/12/01/self-driving-cars-buying-broken">
				                        			<li>Self-driving cars are here, but the friction is in the sale</li>
					    	                	</a>
					    	                          
				                    		
					                    	
					                    
				                	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/11/09/field-notes-5-november-2025">
				                        			<li>Field Notes 5 // ChatGPT Atlas and the Claude cafeÃÅ</li>
					    	                	</a>
					    	                       
				                    		
				                    		
				                    	
				                	
				                	
									
									
				                    	
				                        	
				                        		<a href="/2025/11/02/chatgpt-atlas-ai-browser">
				                        			<li>ChatGPT Atlas positions AI as the internet's gatekeeper</li>
					    	                	</a>
					    	                         
				                    		
				                    		
				                    	
				                	
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
									
									
									
									
									
				                	
									
									
				                	
									
									
						    	
					    	</ul>
				    		</div>
						</div>
					</div>
				</div>

			</div>

		</article>

		<div id="prev_next">
			<div class="prev">
				    
						<a href="/2019/03/01/agile-project-management-framework-introduction/">&laquo;&nbsp;An introduction to the Agile project management framework</a>
					
			</div>
			<div class="next">
			    
					<a href="/2019/03/15/python-windows-forensics-microsoft-office-recent-files/">Python tools for Windows forensics: Microsoft Office recent files&nbsp;&raquo;</a>
				
			</div>
		</div>

				<div id="footer">
			&copy; 2016-25 MattCASmith
			<span class="home-link">Personal blog - does not reflect views of employers past or present</span>
		</div>
		
		<script data-goatcounter="https://mattcasmith.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
		
		</div>
	
	</body>
</html>